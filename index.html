<!DOCTYPE html>
<html lang="pl">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a73e8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script>
        window.addEventListener('beforeinstallprompt', (e) => {
        // Zapobiega domyÅ›lnemu zachowaniu Chrome (opcjonalne)
        // e.preventDefault(); 
        
        // MoÅ¼esz tutaj np. pokazaÄ‡ wÅ‚asny przycisk "ZAINSTALUJ APLIKACJÄ˜"
        console.log('Strona jest gotowa do instalacji jako PWA');
        });

        // Sprawdzenie czy to iPhone i czy NIE jest w trybie standalone
        const isIos = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

        if (isIos && !isStandalone) {
        // Tutaj moÅ¼esz wyÅ›wietliÄ‡ np. showToast('Aby zainstalowaÄ‡: kliknij UdostÄ™pnij -> Do ekranu poczÄ…tkowego');
        console.log('Sugestia instalacji dla iOS');
        }

        // Rejestracja Service Workera
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('PWA Gotowe!', reg))
                .catch(err => console.log('BÅ‚Ä…d PWA', err));
            });
        }
    </script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instalator Pro</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>NiezbÄ™dnik Instalatora</h1>
        </header>

        <main class="grid-container">
           
            <div class="tile" onclick="location.href='tools-src/nadajniki.html'">
                <span class="icon">ğŸ—¼</span>
                <span class="label">Nadajniki DVB-T</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/bibliotekaDVBT.html'">
                <span class="icon">ğŸ“º</span>
                <span class="label">Info DVB-T</span>
            </div>
             <div class="tile" onclick="location.href='tools-src/satelity.html'">
                <span class="icon">ğŸ“¡</span>
                <span class="label">SAT Azymut / Elewacja</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/bibliotekaSAT.html'">
                <span class="icon">ğŸ›°ï¸</span>
                <span class="label">Info SAT</span>
            </div>
           
            
            <div class="tile" onclick="location.href='tools-src/instrukcje.html'">
                <span class="icon">ğŸ“–</span>
                <span class="label">Instrukcje</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/cennik.html'">
                <span class="icon">ğŸ’°</span>
                <span class="label">Cennik</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/Jednostki.html'">
                <span class="icon">â†”ï¸</span>
                <span class="label">Konwerter siÅ‚y sygnaÅ‚u</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/internet.html'">
                <span class="icon">ğŸŒ</span>
                <span class="label">INTERNET / LTE</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/notatki.html'">
                <span class="icon">ğŸ“</span>
                <span class="label">Notatki</span>
            </div>
            <div class="tile" onclick="location.href='tools-src/raporty.html'">
                <span class="icon">ğŸ“‹</span>
                <span class="label">Raporty</span>
            </div>
        </main>

        <footer style="text-align: center; color: gray; font-size: 10px; padding: 10px;">
            v<span id="app-version">1.x</span>, <span id="app-status">tryb sprawdzania...</span>
        </footer>
    </div>
</body>

    <script>
        let backClickCounter = 0;

        // Aplikacja nie korzysta z Cordovy â€” inicjalizujemy przy zaÅ‚adowaniu strony
        window.addEventListener('load', onDeviceReady);
        
        function onDeviceReady() {
            // 1. WERSJA - automatycznie pobierana z manifest.json lub ze zmiennej CACHE_NAME w sw.js
            async function setAppVersion() {
                const el = document.getElementById('app-version');
                if (!el) return;
                // 1) SprÃ³buj pobraÄ‡ manifest.json i odczytaÄ‡ pole `version`
                try {
                    const r = await fetch('manifest.json', {cache: 'no-store'});
                    if (r.ok) {
                        const m = await r.json();
                        if (m.version) { el.innerText = m.version; return; }
                    }
                } catch(e){}
                // 2) Fallback: sprÃ³buj odczytaÄ‡ sw.js i dopasowaÄ‡ wersjÄ™ z CACHE_NAME
                try {
                    const r2 = await fetch('sw.js', {cache: 'no-store'});
                    if (r2.ok) {
                        const txt = await r2.text();
                        const re = /CACHE_NAME\s*=\s*['"]([a-zA-Z0-9\-_.]*v?(\d+(?:\.\d+)+))['"]/i;
                        const m = txt.match(re);
                        if (m && m[2]) { el.innerText = m[2]; return; }
                    }
                } catch(e){}
                // 3) Ostateczny fallback
                el.innerText = '1.0.0';
            }
            setAppVersion();
        
            const statusSpan = document.getElementById('app-status');
        
            // 2. STATUS SIECI
            function updateOnlineStatus() {
                if (navigator.onLine) {
                    statusSpan.innerText = "Tryb ONLINE gotowy";
                    statusSpan.style.color = "#03dac6";
                } else {
                    statusSpan.innerText = "Tryb OFFLINE gotowy";
                    statusSpan.style.color = "gray";
                }
            }
            updateOnlineStatus();
        
            document.addEventListener("offline", updateOnlineStatus, false);
            document.addEventListener("online", updateOnlineStatus, false);
        
            // 3. TEST POÅÄ„CZENIA Z INTERNETEM (opcjonalnie, moÅ¼na zostawiÄ‡ tylko navigator.onLine)
            function testInternetConnection() {
                fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' })
                    .then(() => {
                        statusSpan.innerText = "Tryb ONLINE gotowy";
                        statusSpan.style.color = "#03dac6";
                    })
                    .catch(() => {
                        statusSpan.innerText = "Tryb OFFLINE gotowy";
                        statusSpan.style.color = "gray";
                    });
            }
            testInternetConnection();

            // 4. UKRYTY PRYCISK DO RESETU - licznik klikniÄ™Ä‡ w stopkÄ™
            const footer = document.querySelector('footer');
            if (footer) {
                footer.style.cursor = 'pointer';
                footer.setAttribute('title', 'Kliknij kilka razy, aby zresetowaÄ‡ aplikacjÄ™');

                footer.addEventListener('click', () => {
                    backClickCounter++;
                    // opcjonalnie pokazujemy krÃ³tkie powiadomienie
                    showToast(`KlikniÄ™cia: ${backClickCounter}/5`);
                    if (backClickCounter >= 5) {
                        // potwierdzenie uÅ¼ytkownika przed trwaÅ‚ym usuniÄ™ciem
                        if (confirm('Czy na pewno chcesz zresetowaÄ‡ aplikacjÄ™? To usunie wszystkie dane i cache.')) {
                            // usuÅ„ cache'y service workera
                            if ('caches' in window) {
                                caches.keys().then(names => {
                                    names.forEach(name => caches.delete(name));
                                });
                            }
                            // wyrejestruj service workera (jeÅ›li jest)
                            if (navigator.serviceWorker && navigator.serviceWorker.getRegistrations) {
                                navigator.serviceWorker.getRegistrations().then(regs => {
                                    regs.forEach(r => r.unregister());
                                }).catch(()=>{});
                            }
                            // wyczyÅ›Ä‡ localStorage
                            try { localStorage.clear(); } catch(e) {}
                            // zresetuj licznik i przeÅ‚aduj stronÄ™
                            backClickCounter = 0;
                            location.reload();
                        } else {
                            backClickCounter = 0; // anulowano, resetujemy licznik
                        }
                    }
                });

                // Zeruj licznik kiedy uÅ¼ytkownik opuszcza aplikacjÄ™ lub ukrywa kartÄ™
                window.addEventListener('pagehide', () => { backClickCounter = 0; });
                window.addEventListener('beforeunload', () => { backClickCounter = 0; });
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden) backClickCounter = 0;
                });
            }
        }


        
        // Nasza wÅ‚asna, darmowa funkcja powiadomienia na ekranie
        function showToast(message) {
            // Usuwamy stare powiadomienie jeÅ›li jeszcze istnieje
            const oldToast = document.getElementById('custom-toast');
            if (oldToast) oldToast.remove();
        
            const statusDiv = document.createElement('div');
            statusDiv.id = 'custom-toast';
            statusDiv.style = "position:fixed; bottom:50px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.8); color:white; padding:12px 25px; border-radius:25px; z-index:9999; font-size:14px; white-space:nowrap; border: 1px solid #444;";
            statusDiv.innerText = message;
            document.body.appendChild(statusDiv);
        
            // Animacja znikania
            setTimeout(() => {
                statusDiv.style.opacity = '0';
                statusDiv.style.transition = 'opacity 0.5s ease';
                setTimeout(() => statusDiv.remove(), 500);
            }, 2000);
        }

        


    </script>
</html>